<div class="treatment-list-container">
  <!-- Header Card -->
  <mat-card class="header-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>people</mat-icon>
        Liste des Patients
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Rechercher un patient (nom, prénom, numéro...)</mat-label>
        <input 
          matInput 
          [value]="searchTerm"
          (input)="onSearchChange($any($event.target).value || '')"
          placeholder="Rechercher...">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </mat-card-content>
  </mat-card>

  <!-- Loading spinner -->
  <div class="loading-container" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Chargement des patients...</p>
  </div>

  <!-- Patients Table Card -->
  <mat-card *ngIf="!isLoading" class="patients-table-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>people</mat-icon>
        Patients avec Soins
      </mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <mat-table [dataSource]="patients" class="patients-table">
      
      <!-- Patient Number Column -->
      <ng-container matColumnDef="patientNumber">
        <mat-header-cell *matHeaderCellDef>N° Fiche</mat-header-cell>
        <mat-cell *matCellDef="let patient">
          <strong>{{ patient.patientNumber }}</strong>
        </mat-cell>
      </ng-container>

      <!-- First Name Column -->
      <ng-container matColumnDef="firstName">
        <mat-header-cell *matHeaderCellDef>Prénom</mat-header-cell>
        <mat-cell *matCellDef="let patient">
          {{ patient.firstName }}
        </mat-cell>
      </ng-container>

      <!-- Last Name Column -->
      <ng-container matColumnDef="lastName">
        <mat-header-cell *matHeaderCellDef>Nom</mat-header-cell>
        <mat-cell *matCellDef="let patient">
          {{ patient.lastName }}
        </mat-cell>
      </ng-container>

      <!-- Phone Number Column -->
      <ng-container matColumnDef="phoneNumber">
        <mat-header-cell *matHeaderCellDef>Téléphone</mat-header-cell>
        <mat-cell *matCellDef="let patient">
          {{ patient.phoneNumber || '-' }}
        </mat-cell>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <mat-header-cell *matHeaderCellDef>Actions</mat-header-cell>
        <mat-cell *matCellDef="let patient">
          <div class="action-buttons">
            <button mat-icon-button 
                    class="add-button"
                    (click)="onAddTreatment(patient)"
                    matTooltip="Ajouter un soin">
              <mat-icon>add_circle</mat-icon>
            </button>
            
            <button mat-icon-button 
                    class="treatments-button"
                    (click)="onViewTreatments(patient)"
                    matTooltip="Voir les soins du patient">
              <mat-icon>medical_services</mat-icon>
            </button>
          </div>
        </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
    </mat-table>

    <!-- No results message -->
    <div class="no-results" *ngIf="patients.length === 0 && !isLoading">
      <mat-icon>person_off</mat-icon>
      <h3>Aucun patient trouvé</h3>
      <p *ngIf="searchTerm">Essayez de modifier votre recherche</p>
      <p *ngIf="!searchTerm">Aucun patient enregistré dans le système</p>
    </div>
    </mat-card-content>
  </mat-card>

  <!-- Pagination -->
  <mat-paginator 
    *ngIf="patients.length > 0"
    [length]="totalCount"
    [pageSize]="pageSize"
    [pageSizeOptions]="[5, 10, 20, 50]"
    [pageIndex]="currentPage - 1"
    (page)="onPageChange($event)"
    showFirstLastButtons="true"
    class="mat-paginator">
  </mat-paginator>
</div>
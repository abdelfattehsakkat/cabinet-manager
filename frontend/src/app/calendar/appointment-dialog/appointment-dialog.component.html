<div class="appointment-dialog">
  <div class="dialog-header">
    <mat-icon class="header-icon">{{data.appointment ? 'edit_calendar' : 'add_box'}}</mat-icon>
    <h2 mat-dialog-title>{{data.appointment ? 'Modifier le Rendez-vous' : 'Nouveau Rendez-vous'}}</h2>
  </div>

  <mat-dialog-content class="dialog-content">
    <form [formGroup]="appointmentForm" (ngSubmit)="onSubmit()">
      <!-- Section Patient -->
      <div class="form-section">
        <div class="section-header">
          <mat-icon>person</mat-icon>
          <span>Informations Patient</span>
        </div>
        
        <mat-form-field class="full-width patient-field">
          <mat-label>Patient</mat-label>
          <input type="text" 
                 matInput 
                 formControlName="patientName" 
                 [matAutocomplete]="auto" 
                 (input)="onPatientInput()"
                 placeholder="Tapez le nom du patient ou créez un nouveau patient"
                 required>
          <mat-icon matPrefix>search</mat-icon>
          <mat-autocomplete #auto="matAutocomplete" 
                            [displayWith]="displayPatient.bind(this)" 
                            (optionSelected)="onPatientSelected($event.option.value)">
            <mat-option *ngFor="let patient of filteredPatients | async" [value]="patient">
              <div class="patient-option">
                <div class="patient-info">
                  <span class="patient-name">{{patient.firstName}} {{patient.lastName}}</span>
                  <span class="patient-number" *ngIf="patient.patientNumber">N° {{patient.patientNumber}}</span>
                </div>
                <mat-icon class="patient-icon">person</mat-icon>
              </div>
            </mat-option>
          </mat-autocomplete>
          <mat-hint *ngIf="selectedPatient" class="success-hint">
            <mat-icon class="status-icon success">check_circle</mat-icon>
            Patient existant - N° {{selectedPatient.patientNumber}}
          </mat-hint>
          <mat-hint *ngIf="isNewPatient && appointmentForm.get('patientName')?.value" class="info-hint">
            <mat-icon class="status-icon info">person_add</mat-icon>
            Nouveau patient
          </mat-hint>
          <mat-error *ngIf="appointmentForm.get('patientName')?.invalid">{{getErrorMessage('patientName')}}</mat-error>
        </mat-form-field>
      </div>

      <!-- Section Rendez-vous -->
      <div class="form-section">
        <div class="section-header">
          <mat-icon>schedule</mat-icon>
          <span>Planification</span>
        </div>
        
        <div class="form-row">
          <mat-form-field class="date-field">
            <mat-label>Date</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="date" required>
            <mat-icon matPrefix>calendar_today</mat-icon>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf="appointmentForm.get('date')?.invalid">{{getErrorMessage('date')}}</mat-error>
          </mat-form-field>

          <mat-form-field class="time-field">
            <mat-label>Heure</mat-label>
            <mat-select formControlName="time" required>
              <mat-option value="09:00">09:00</mat-option>
              <mat-option value="09:15">09:15</mat-option>
              <mat-option value="09:30">09:30</mat-option>
              <mat-option value="09:45">09:45</mat-option>
              <mat-option value="10:00">10:00</mat-option>
              <mat-option value="09:15">09:15</mat-option>
              <mat-option value="09:30">09:30</mat-option>
              <mat-option value="09:45">09:45</mat-option>
              <mat-option value="10:00">10:00</mat-option>
              <mat-option value="10:15">10:15</mat-option>
              <mat-option value="10:30">10:30</mat-option>
              <mat-option value="10:45">10:45</mat-option>
              <mat-option value="11:00">11:00</mat-option>
              <mat-option value="11:15">11:15</mat-option>
              <mat-option value="11:30">11:30</mat-option>
              <mat-option value="11:45">11:45</mat-option>
              <mat-option value="12:00">12:00</mat-option>
              <mat-option value="12:15">12:15</mat-option>
              <mat-option value="12:30">12:30</mat-option>
              <mat-option value="12:45">12:45</mat-option>
              <mat-option value="13:00">13:00</mat-option>
              <mat-option value="13:15">13:15</mat-option>
              <mat-option value="13:30">13:30</mat-option>
              <mat-option value="13:45">13:45</mat-option>
              <mat-option value="14:00">14:00</mat-option>
              <mat-option value="14:15">14:15</mat-option>
              <mat-option value="14:30">14:30</mat-option>
              <mat-option value="14:45">14:45</mat-option>
              <mat-option value="15:00">15:00</mat-option>
              <mat-option value="15:15">15:15</mat-option>
              <mat-option value="15:30">15:30</mat-option>
              <mat-option value="15:45">15:45</mat-option>
              <mat-option value="16:00">16:00</mat-option>
              <mat-option value="16:15">16:15</mat-option>
              <mat-option value="16:30">16:30</mat-option>
              <mat-option value="16:45">16:45</mat-option>
            </mat-select>
            <mat-icon matPrefix>access_time</mat-icon>
            <mat-error *ngIf="appointmentForm.get('time')?.invalid">{{getErrorMessage('time')}}</mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field class="duration-field">
            <mat-label>Durée</mat-label>
            <mat-select formControlName="duration" required>
              <mat-option value="15">15 minutes</mat-option>
              <mat-option value="30">30 minutes</mat-option>
              <mat-option value="45">45 minutes</mat-option>
              <mat-option value="60">1 heure</mat-option>
              <mat-option value="90">1h 30</mat-option>
              <mat-option value="120">2 heures</mat-option>
            </mat-select>
            <mat-icon matPrefix>timer</mat-icon>
            <mat-error *ngIf="appointmentForm.get('duration')?.invalid">
              {{getErrorMessage('duration')}}
            </mat-error>
          </mat-form-field>

          <mat-form-field class="type-field">
            <mat-label>Type de consultation</mat-label>
            <mat-select formControlName="type" required>
              <mat-option *ngFor="let type of appointmentTypes" [value]="type">
                {{type}}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix>local_hospital</mat-icon>
            <mat-error *ngIf="appointmentForm.get('type')?.invalid">{{getErrorMessage('type')}}</mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Section Notes -->
      <div class="form-section">
        <div class="section-header">
          <mat-icon>note</mat-icon>
          <span>Notes complémentaires</span>
        </div>
        
        <mat-form-field class="full-width notes-field">
          <mat-label>Notes</mat-label>
          <textarea matInput formControlName="notes" rows="3" 
                    placeholder="Informations complémentaires sur le rendez-vous..."></textarea>
          <mat-icon matPrefix>notes</mat-icon>
        </mat-form-field>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions class="dialog-actions" align="end">
    <button mat-stroked-button color="warn" (click)="onCancel()" class="cancel-button">
      <mat-icon>close</mat-icon>
      Annuler
    </button>
    <button mat-raised-button color="primary" (click)="onSubmit()" 
            [disabled]="!appointmentForm.valid" class="submit-button">
      <mat-icon>{{data.appointment ? 'save' : 'add'}}</mat-icon>
      {{data.appointment ? 'Modifier' : 'Créer'}}
    </button>
  </mat-dialog-actions>
</div>